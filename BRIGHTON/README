% "this directory" refers to https://github.com/barrycarter/bcapps/blob/master/BRIGHTON/

% I am installing from an old Fedora Core 11 machine (hereafter called
"dullon") using ssh and vncserver to access a my new machine; for
testing, I will create a VM version of it first, and then follow the
same steps to create it in production.

% To create a CentOS 7 machine that runs VirtualBox, see
"bc-install-virtualbox-on-centos7.txt" in this directory.. This
machine is hereafter called "brighton"

% To create a CentOS 7 virtual machine (hereafter called
"babybrighton"), see bc-create-vm-with-virtualbox.txt in this
directory.

% OPTIONAL: on dullon add a line like this to /etc/hosts so you can
access the machine as babybrighton

192.168.0.100 babybrighton 

%% TODO: whine about default CentOS7 not enable network (+ not even
showing option until you choose partitioning) -- maybe take screenshot

%% TODO: disclaim why I'm using VirtualBox over KVM (/dev/sdb only!)

%% TODO: merge CENTOS/FEDORA/BRIGHTON dirs into one semi-coherent mass

%% TODO: disclaim everything

This documents my attempt to setup "brighton", a new CentOS 7.2
machine, first as a VM, and later as a physical machine. My current
machine is running Fedora Core 11, and I will its existing files as a
"fallback" for certain things (eg, binaries and libraries absolutely
not available via CentOS 7.2 or that I am too lazy to install from
tertiary sources) [default install + CentOS 7 included/approved
repositories = primary source, unapproved repositories = secondary
source]

How to read this document:

  - A left flush "%% TODO:" indicates a step I need to do and that is
  not complete yet.

  - A left flush "% IMP:" indicates an important note about the steps
  that follow. You should not follow the steps that come afterwards
  unless you are sure you know what you're doing.

  - A left flush "% NOTE:" indicates a note that is optional reading
  and may explain why a certain step must be performed in a specific
  way and why other reasonable-seeming ways to perform that step may
  not be correct, or a comment on why this step is performed.

  - Any other left flush "% " indicates a step to follow.

% Boot babybrighton in detachable mode and enter disk password

% You no longer need the X window that VirtualBox brings up, so go to
Machine/Detach GUI to get rid of it.

% From dullon, "ssh root@babybrighton"

% I prefer tcsh and many things I do rely on it, so:

yum -y install tcsh
chsh -s /bin/tcsh root
chsh -s /bin/tcsh user

%% TODO: should I move the steps above elsewhere?

% run "make" in this directory on dullon, so the following rsync will
push over yum-runme.sh

% rsync the latest BCGIT to babybrighton (dullon is 192.168.0.2) from
babybrighton itself

yum -y install rsync
rehash
rsync -Pavz root@192.168.0.2:/home/barrycarter/BCGIT /home/user/

: and private stuff I still need
rsync -Pavz root@192.168.0.2:/home/barrycarter/BCPRIV /home/user/

% Install X11 as a group

: next line just makes group stuff faster in future

yum groups mark convert

: note this only shows up with "yum grouplist hidden" not w/o "hidden"

yum -y groupinstall "X Window System"

% Install "approved" repositories

sh ~user/BCGIT/BRIGHTON/repos.sh

% Create cache of meta data (improves speed):

yum makecache

% and install applydeltarpm to possibly speed things up

yum -y install deltarpm

% run yum-runme.sh as follows:

sh ~user/BCGIT/BRIGHTON/yum-runme.sh |& tee /tmp/yum-runme.out

% and bc-cpan.sh

sh ~user/BCGIT/BRIGHTON/bc-cpan.sh |& tee /tmp/cpan.out

% Consider snapshotting here as "postmassinstall" UNLESS yun-runme.sh
dies on an error (warnings are ok). As always, "shutdown -h" first.

% If needed (or if restoring snapsht here), rsync over BCGIT again

% create symlinks:

sh ~user/BCGIT/BRIGHTON/bc-symlinks.sh |& tee /tmp/bc-symlinks.out

% Ugly install of fly (older version, newer is broken)

cd /root/build
cp ~user/Downloads/fly-1.6.5.tar.gz .
tar xvfz fly-1.6.5.tar.gz
cd fly-1.6.5
make
cp fly /usr/local/bin/
chmod +x /usr/local/bin/fly
: do not appear to need this
: cp gd1.3/libgd.a /usr/local/lib/

% start the crontab

crontab -u user /home/user/BCGIT/BRIGHTON/bc-public-crontab

% install cpan stuff (todo: consider merging this into the mass
install, it's fairly tedious)

sh ~user/BCGIT/BRIGHTON/bc-cpan.sh |& tee /tmp/bc-cpan.out

% add to /etc/rc.local (TODO: find a better way to do this) to reset
time on reboot (TODO: don't realy on non-NIST server?):

rdate -s utcnist.colorado.edu

% Import databases as necessary:



%% TODO: am snapshotting (after shutdown) here as "Xable"; if this
really does let me use X normally, keep this snapshot; else tweak (aka
can I xinit login at this point?)

%% TEST: to avoid losing edited files from babybrighton, this ssh lets
me edit files live on dullon:

: must do below as root
sudo mkdir -p /DULLON/BCGIT; sudo chown -R user /DULLON
sshfs -o allow_other root@192.168.0.2:/home/barrycarter/BCGIT /DULLON/BCGIT

: then, as user, redirect symlink
rm /home/user/.fvwm/.fvwm2rc
ln -s /DULLON/BCGIT/BRIGHTON/.fvwm2rc /home/user/.fvwm


% Cut and paste results of below into nopkglist.txt: the packages I
want that CentOS doesn't provide:

fgrep "No package " /tmp/yum-runme.out|perl -anle 'print $F[2]'|sort|uniq|less

%% TODO: compare all lib and bin files from old machine (perhaps using fc11root) and new machine to see what I'm missing

% NOTE: to list all bin and lib files on a machine (which I can use to
compare my current bin files on dullon to those on babybrighton to see
what I'm "missing"):

: there are other /bin and /sbin dirs, but they appear less important
: /bin does not appear directly in CentOS 7, but may on other systems
: /usr/X11R6/bin/ is an archaism from FC11

: of course, these steps could be combined but intermediate files are useful

setenv FOO babybrighton
export FOO="babybrighton"

find /usr/sbin /usr/local/sbin /usr/bin /usr/local/bin /bin /sbin 
 /usr/X11R6/bin/ -type f -o -type l > /tmp/$FOO-binlist0.txt

perl -pnle 's%^.*/%%' /tmp/$FOO-binlist0.txt|sort -u > /tmp/$FOO-binlist1.txt

: can then use comm to compare the two bin lists

%% TODO: above for libs, common names are:

/var/lib /usr/lib /usr/local/lib /lib

%% TODO: consider making this entire document even more specific to me and avoid the "IF THEN" stuff

%% TODO: try to include reference URLs (using Firefox history if
needed) when doing something unusual or difficult

%% TODO: make sure no colon parens and explain why (or go # all the way?)

%% TODO: explain ":" comments

%% TODO: use chkconfig/systemctl on guest to make sure what I want comes up (ps -auxwww or ps -ef to see whats actually running)

%% TODO: look at TODOs from FEDORA and CENTOS and VM

%% TODO: configure /etc/hosts on babybrighton

%% TODO: symlink urxvt to rxvt

%% TODO: put "significant legacy" note in this dir, ../CENTOS* ../VM/ and ../FEDORA

%% TODO: figure out why /usr/local/bin/surl did to not get transferred
to /fc11oldroot from dullon or whatever (and redo this rsync to keep up?)

%% TODO: consider virtualizing dullon so I can cut over to new machine ASAP

%% TODO: more cpan stuff

%% TODO: fixed IP addr, no NetworkManager

%% TODO: at some point, decide how much to put in shell scripts and
how much to run manually (stuff that needs pw or that I want to verify
= manually?)

%% TODO: create precedence level for TODO, and don't require user to
stop for minor ones (or move minor TODO to end)


